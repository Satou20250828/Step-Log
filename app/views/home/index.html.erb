<section class="mx-auto w-full max-w-5xl">
  <p class="mb-8 text-center text-xs font-bold uppercase tracking-[0.18em] text-[#617c89]">
    今日: <%= Date.current.strftime("%Y/%m/%d") %>
  </p>

  <% if current_user.habit %>
    <div class="mb-8 rounded-3xl border border-[#dbe2e6] bg-white p-6 shadow-sm">
      <p class="text-sm font-semibold text-[#617c89]">継続中の習慣</p>
      <h1 class="mt-1 text-3xl font-extrabold tracking-tight">
        <span class="text-[#2badee]"><%= current_user.habit.name %></span>
      </h1>
      <p class="mt-3 inline-flex items-center gap-2 rounded-full bg-[#edf8fd] px-4 py-2 text-sm font-medium text-[#476270]">
        <span class="icon text-[18px]">info</span>
        今日はすでに記録済みでも、押し直して更新できます。
      </p>
      <% if @today_record %>
        <% label = { "done" => "できた", "a_little" => "少しだけ", "skipped" => "お休み" }[@today_record.result] %>
        <p class="mt-3 text-sm font-bold text-[#476270]">今日の記録: <span class="text-[#111618]"><%= label %></span></p>
      <% end %>
    </div>

    <% selected_result = @today_record&.result %>
    <div class="mb-8 grid grid-cols-1 gap-4 md:grid-cols-3">
      <%= button_to records_path(record: { result: "done" }),
                    method: :post,
                    form: { class: "w-full" },
                    class: "group w-full rounded-2xl p-6 transition hover:scale-[1.01] py-8 md:p-6 active:scale-95 md:active:scale-100 flex flex-col items-center justify-center md:block text-center md:text-left #{selected_result == "done" ? "border-4 border-blue-600 bg-blue-600 text-white shadow-md" : "border-2 border-blue-300 bg-white text-blue-800 hover:border-blue-500 hover:bg-blue-50"}" do %>
        <span class="icon block text-5xl <%= selected_result == "done" ? "text-white" : "text-blue-600" %>">task_alt</span>
        <span class="mt-3 block text-xl font-extrabold">できた！</span>
      <% end %>

      <%= button_to records_path(record: { result: "a_little" }),
                    method: :post,
                    form: { class: "w-full" },
                    class: "group w-full rounded-2xl p-6 transition hover:scale-[1.01] py-8 md:p-6 active:scale-95 md:active:scale-100 flex flex-col items-center justify-center md:block text-center md:text-left #{selected_result == "a_little" ? "border-4 border-blue-400 bg-blue-400 text-white shadow-md" : "border-2 border-blue-300 bg-white text-blue-800 hover:border-blue-500 hover:bg-blue-50"}" do %>
        <span class="icon block text-5xl <%= selected_result == "a_little" ? "text-white" : "text-blue-600" %>">trending_flat</span>
        <span class="mt-3 block text-xl font-extrabold">少しだけ</span>
      <% end %>

      <%= button_to records_path(record: { result: "skipped" }),
                    method: :post,
                    form: { class: "w-full" },
                    class: "group w-full rounded-2xl p-6 transition hover:scale-[1.01] py-8 md:p-6 active:scale-95 md:active:scale-100 flex flex-col items-center justify-center md:block text-center md:text-left #{selected_result == "skipped" ? "border-4 border-blue-200 bg-blue-200 text-blue-800 shadow-md" : "border-2 border-blue-300 bg-white text-blue-800 hover:border-blue-500 hover:bg-blue-50"}" do %>
        <span class="icon block text-5xl <%= selected_result == "skipped" ? "text-blue-800" : "text-blue-600" %>">hotel</span>
        <span class="mt-3 block text-xl font-extrabold">お休み</span>
      <% end %>
    </div>

    <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
      <div class="rounded-3xl border border-[#dbe2e6] bg-white p-8 shadow-sm lg:col-span-1">
        <p class="text-xs font-bold uppercase tracking-[0.2em] text-[#617c89]">達成状況</p>
        <p class="mt-3 text-6xl font-extrabold leading-none text-[#2badee]"><%= @total_recorded_days %></p>
        <p class="mt-2 text-lg font-bold">積み上げた日数</p>
        <p class="mt-4 text-sm text-[#617c89]">今月の記録日数: <span class="font-bold text-[#111618]"><%= @this_month_recorded_days %>日</span></p>
      </div>

      <div class="rounded-3xl border border-[#dbe2e6] bg-white p-6 shadow-sm lg:col-span-2">
        <div class="mb-3 flex items-center justify-between">
          <h2 class="text-lg font-extrabold">最近の履歴</h2>
          <span class="text-xs font-semibold uppercase tracking-[0.1em] text-[#617c89]">直近7件</span>
        </div>
        <% if @recent_records.any? %>
          <ul class="overflow-hidden rounded-2xl border border-[#e4ecef]">
            <% @recent_records.each do |record| %>
              <% icon = { "done" => "task_alt", "a_little" => "trending_flat", "skipped" => "hotel" }[record.result] %>
              <% text = { "done" => "できた", "a_little" => "少しだけ", "skipped" => "お休み" }[record.result] %>
              <li class="flex items-center justify-between border-b border-[#edf3f6] bg-white px-4 py-3 text-sm last:border-b-0">
                <span class="inline-flex items-center gap-2 font-semibold">
                  <span class="icon text-[20px] text-[#2badee]"><%= icon %></span>
                  <%= text %>
                </span>
                <span class="font-medium text-[#617c89]"><%= record.recorded_on.strftime("%-m/%-d") %></span>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p class="rounded-xl bg-[#f7fbfd] px-4 py-4 text-sm text-[#617c89]">まだ記録がありません。</p>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="mx-auto max-w-2xl rounded-3xl border border-[#dbe2e6] bg-white p-8 text-center shadow-sm">
      <h1 class="text-2xl font-extrabold tracking-tight">どんな習慣を始めますか？</h1>
      <p class="mt-2 text-sm text-[#617c89]">まずは1つだけ。小さく続ける目標を登録しましょう。</p>
      <%= link_to "習慣を登録する",
                  new_habit_path,
                  class: "mt-6 inline-flex h-12 items-center justify-center rounded-xl bg-[#2badee] px-6 text-base font-bold text-white transition hover:brightness-105" %>
    </div>
  <% end %>
</section>
